---
title: HTTP
date: 2019-09-18 16:18:40
tags:
---
## 网络基础TCP/IP

### 分层管理

- 4层
  - 应用层：向用户提供应用服务时通信的活动。TCP/IP内置了各类通用的应用服务：比如FTP、**HTTP**和DNS。
  - 传输层：提供网络连接中两台计算机之间的数据传输，有TCP(Transmission Control Protocol，传输控制协议)和UDP(User Data Protocol，用户数据协议)2个协议。
  - 网络层：用来处理网络上流动的数据包。数据包是网络传输的最小单位。与多台计算机进行传输时，网络层会在众多路线中选择一条。IP协议属于此层。在TCP/IP协议中，ARP属于网络层。
  - 链路层(网络接口层)：用来处理网络连接的硬件部分。
- 5层（网络接口层被拆分为数据链路层和物理层）
  - 应用层
  - 传输层
  - 网络层
  - 数据链路层
  - 物理层
- 7层（应用层被拆分为应用层，表示层和会话层）
  - 应用层
  - 表示层
  - 会话层
  - 传输层
  - 网络层
  - 数据链路层
  - 物理层

数据在传输过程中，每一层都会封装一个首部信息。
IP间的通信依赖MAC地址(Media Access Control Address)。在实际的网络中，两台计算机处于局域网的情况相对来说较少，通常是经过多台计算机和中转设备才能相互连接。在进行中转时，会利用中转设备的MAC地址来搜索下一个中转目标。这时会使用ARP(Address Resolution Protocol，地址解析协议)。ARP是一种解析地址的协议，可以根据通信双方的IP地址反查出对应的MAC地址。

### TCP传输三次握手策略

握手过程中使用了SYN(synchronize)和ACK(acknowledge)两个标志。发送端首先发送一个带SYN标志的数据包，接收端收到后，回传一个带有SYN/ACK标志的数据包，最后，发送端再回传一个带ACK标志的数据包，代表此次握手结束。

### 浏览器输入URL问题(待填坑)

客户端：想浏览http://abc.com/xxx ->
通过DNS查询到IP为123.x.x.x ->
HTTP协议根据目标服务器生成HTTP请求报文 ->
TCP协议为了方便通信，将报文按照序号分割成报文段，把每个报文段按照三次握手的方式进行传输 ->
IP协议搜索对方的地址，一边中转一边传输数据 ->
服务端：TCP协议处理了来自客户端的报文段，将其按照分割时的序号重组请求的报文 ->
HTTP负责对报文进行处理，然后将服务器上的xxx资源同样按照TCP/IP通信协议回传给客户端

## HTTP/1.1

### 常用方法

- GET：获取资源
- POST：传输实体主体
- PUT：传输文件
- HEAD：获得报文首部(和GET方法类似，但不返回报文主体)
- DELETE：删除文件
- OPTIONS：查询支持的方法
- TRACE：跟踪路径
- CONNECT：要求用隧道协议连接代理

### 持久连接

在HTTP/1.1中，所有链接默认为持久连接，只要任意一端没有明确提出断开连接，则保持TCP连接状态，减少通信的开销。

## HTTP报文内的HTTP信息

报文(message)：HTTP通信的基础单位。
实体(entity)：作为请求和响应的有效载荷数据。由实体首部和实体主体组成。
报文主体通常等于实体主体，只有在传输中进行编码操作，会导致实体内容发生变化。

MIME(Multipurpose Internet Mail Extensions，多用途互联网邮件拓展)使用一种称为multipart的方法，来容纳多份不同类型的数据。常见的有：

- multipart/form-data：在web表单文件上传时使用。
- multipart/byteranges：状态码206响应报文包含了多个范围的内容时使用(比如把一张1000B的图片分成1-500和501-1000B请求)。

## 常见状态码

### 2xx成功

- 200 OK 正常处理
- 204 No Content 不含实体主体或者不允许返回实体主体
- 206 Partial Content 部分内容，响应报文包含由Content-Range指定范围的实体内容

### 3xx重定向

- 301 Moved Permanently 永远性移动。资源已经被分配了新的URI
- 302 Found 临时性移动。资源被临时分配了新的URI
- 303 See Other 请求的资源存在另一个URI，应使用GET方法定向获取资源
- 304 Not Modified 当客户端发送GET请求，并且请求报文中包含if-match，if-modified-since，if-none-match，if-range，if-unmodified-since时，服务器允许访问资源，但为满足条件的情况。304状态码返回时，不包含任何响应的主体部分。
- 307 Temporary Redirect 临时重定向。与302类似，但不会从POST变成GET

### 4xx客户端错误

- 400 Bad Request 请求的报文语法存在错误。需修改请求的内容再次发送请求。浏览器会像200一样对待该状态
- 401 Unauthorized 请求需要通过HTTP认证，若之前已经进过一次请求，则表示该次请求认证失败。返回401响应必须包含一个被请求资源的WWW-Authenticate首部用于质询用户信息。浏览器初次接受401响应，会弹出认证用的对话框
- 403 Forbidden 对资源的请求被服务器拒绝了。如果需要，可在实体主体部分说明理由
- 404 Not Found 服务器无法找到请求的资源

### 5xx服务器错误

- 500 Internal Server Error 内部服务器错误
- 502 Bad Gateway 网关错误
- 503 Service Unavailable 服务不可用。服务器暂时处于超负荷或者停机维护。如果事先得知解除以上情况需要的时间，可以在响应首部加入RetryAfter字段再返回给客户端

## HTTP/2.0新特性

- 多路复用：通过单一的HTTP/2连接请求发起多重的请求-响应消息，多个请求stream共享一个TCP连接，实现多留并行而不是依赖建立多个TCP连接。
- 服务器推送
- 头信息压缩
- 二进制协议

## HTTPS

- https需要CA证书
- https则是具有安全性的SSL加密传输协议
- https默认端口为443
- https可进行身份认证、加密传输

### https工作流程

第一步：客户使用https的URL访问Web服务器，要求与Web服务器建立SSL连接。

第二步：Web服务器收到客户端请求后，会将网站的证书信息（证书中包含公钥）传送一份给客户端。

第三步：客户端的浏览器与Web服务器开始协商SSL连接的安全等级，也就是信息加密的等级。

第四步：客户端的浏览器根据双方同意的安全等级，建立会话密钥，然后利用网站的公钥将会话密钥加密，并传送给网站。

第五步：Web服务器利用自己的私钥解密出会话密钥。

第六步：Web服务器利用会话密钥加密与客户端之间的通信。
